<!DOCTYPE html>
<head>
<meta name="viewport" content="width=device-width">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Регистрация</title>
<link rel="icon" href="favicon.ico">	
<link rel="stylesheet" media="screen" type="text/css" href="css/style.css" title="">
<link rel="stylesheet" media="screen" type="text/css" href="css/portable_style.css" title="">
<script src='js/jquery-11.0.min.js' type="text/javascript"></script>
</head>
<body onload="$('#mainform').focus();">
<div class="top_nav">
	<div class="container">
		<div class="menu fullsize">
			<ul>
				<li><a href="login.html">Войти</a></li><div class="arrow"></div>
				<li><a href="register.html">Регистрация</a></li> 
			</ul>
		</div>
	</div>
</div>
<div class="ddmenu" id="ddm">
	<li><a href="login.html">Войти</a></li><div class="arrow"></div>
	<li><a href="register.html">Регистрация</a></li>
	<hr style="margin-top:10px;margin-bottom:10px;border:0; border-top: #FFF dashed  1px;">
</div>
<div id="pagewrapper">
	<a href="index.html"><div class="skylogo"></div></a>
<div class="search_form">
<form method="GET" action="index.html" autocomplete="off">
<input onfocus="this.selectionStart = this.selectionEnd = this.value.length;" onclick="firstfocus=0;(this.value.length)>0?$('#suggestions').show():0;" onkeypress="(event.keyCode==32 && firstfocus==1)?($('#mainform').blur()):0;firstfocus=0;" oninput="(this.value.length)>0?get_suggestions(this.value):$('#suggestions').hide()" type=text name=search id="mainform" placeholder="Что будем искать? " value="" class="top_search">
<!-- Скрипт отвечает за поиск -->
<script> 
var cur_loc=window.location.href;
cur_loc=cur_loc.replace(/\?t=[0-9]+/g,"");  
function get_suggestions(query){
	if($(window).width()>880)
		$.ajax({
		  url: "/suggestions.php",
		  type: "post", //отправить его методом get
		  data:{q: query},
		  dataType:'json',
		  success: function(response) {
			suggestions=response;
			if(suggestions.length==0){
				$('#suggest_container').empty(); 
			}else{
				$('#suggest_container').empty();   
				for(var i=0;i<suggestions.length;i++){ 
					if(suggestions[i][1]==0)
						$('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('"+suggestions[i][0]+"');window.location.replace('/c"+parseInt(suggestions[i][2])+"/s/')\"><span style='color:#606060;font-weight:normal;padding-right:2px;'>Категория</span>&nbsp;"+suggestions[i][3]+""+suggestions[i][0]+"&nbsp;<img src='/styles/goto.png' style='width:11px;'></div>")	
					else
						if(suggestions[i][1]==3)
								$('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('"+suggestions[i][0]+"');window.location.replace('/"+encodeURIComponent(suggestions[i][2])+"/')\"><span style='color:#606060;font-weight:normal;padding-right:2px;'>Лот</span>&nbsp;"+suggestions[i][0]+"&nbsp;<span style='color:#606060;font-weight:normal;padding-right:2px;'>("+suggestions[i][2]+")</span>&nbsp;<img src='/styles/goto.png' style='width:11px;'></div>")	
						else
							if(suggestions[i][1]==2)
									$('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('"+suggestions[i][0]+"');window.location.replace('/"+encodeURIComponent(suggestions[i][0])+"')\"><span style='color:#606060;font-weight:normal;padding-right:2px;'>Пользователь</span>&nbsp;"+suggestions[i][3]+""+suggestions[i][0]+"&nbsp;<img src='/styles/goto.png' style='width:11px;'></div>")	
							else
								$('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('"+suggestions[i][0]+"');window.location.replace('/search.php?search="+encodeURIComponent(suggestions[i][0])+"')\">"+suggestions[i][0]+"</div>")	
				}
				$('#suggestions').show()	
			} 
		  },
		  error: function(xhr) { 
		  }
		});
} 
var rp=45*60*1000;
$(window).bind('focus', function() { 
; 

window.clearTimeout(rTimer);
rTimer=setTimeout(function() {var meta = document.createElement('meta'); meta.name = "referrer"; meta.content = "no-referrer"; document.getElementsByTagName('head')[0].appendChild(meta); window.location.href = cur_loc+'?t='+1}, rp)
 });

var rTimer=setTimeout(function() {var meta = document.createElement('meta'); meta.name = "referrer"; meta.content = "no-referrer"; document.getElementsByTagName('head')[0].appendChild(meta); window.location.href = cur_loc+'?t='+1}, rp);
  
</script>
<input id='checkbox_hidden' type='hidden' value='0' name='desc_check'>
<input id='cat_hidden' type='hidden' value='0' name='catid'>
<input type=submit>
</div>
<div class="suggestions" style="display:none" id="suggestions">

</div>
</form>
</div>
</div>
</div>
<script>
modal_multisearch=document.getElementById('modal_multisearch'); 
</script><div class="mcenter">
<div class="bodywrapper">
<br>
<script>
	function showPass(){ 
		var type = $('.pass').attr('type') == "text" ? "password" : 'text';
		$('.pass').prop('type', type);
	}
	
	
	function isUserActive(username){
			$.getJSON('check_account6fb6.html?exist=1', {name:username}, function(list){  
				var active=""
                $.each(list, function(i){ 
					active=this 
                });  
				if(active==1){ 
					$('#user_login').css('border-bottom','3px solid red')
					$('#lche_error').show()
				}else{   
					$('#user_login').css('border-bottom','1px solid #d0d0d0')
					$('#lche_error').hide()		
				} 
            });
	};
	
	function passCheck(){
			$.getJSON('check_account.html', {pass:$('#pass').val(),login:$('#user_login').val(),email:$('#user_email').val()}, function(list){  
				var valid=""
                $.each(list, function(i){ 
					valid=this 
                });  
				if(valid==0){ 
					$('#pass').css('border-bottom','3px solid red')
					$('#pchv_error').show()
				}else{   
					$('#pass').css('border-bottom','1px solid #d0d0d0')
					$('#pchv_error').hide()		
				} 
            });
	};
		
	function check_email(){  
		if(!$('#user_email').val().match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/g)){
			$('#user_email').css('border-bottom','3px solid red')
            $('#ech_error').show()
            return false;
		}else{
			$('#user_email').css('border-bottom','1px solid #d0d0d0')
			$('#ech_error').hide()
            isUserActive($('#user_email').val())
            return true;
		}		
	}
	
	function check_pass(){  
		if(!$('#pass').val().match(/^(?=.*\d)(?=.*[a-zA-Z]).{6,32}$/g)){
			$('#pass').css('border-bottom','3px solid red')
			$('#pch_error').show()
		}else{
			$('#pass').css('border-bottom','1px solid #d0d0d0')
			$('#pch_error').hide()
			passCheck()
		}		
	}
	
	function check_pass2(){  
		if($('#pass2').val()!=$('#pass').val()){
			$('#pass2').css('border-bottom','3px solid red')
			$('#ppch_error').show()
		}else{
			$('#pass2').css('border-bottom','1px solid #d0d0d0')
			$('#ppch_error').hide()
			passCheck()
		}		
	}
	
	function onSubmit(token){
		document.getElementById("aform").submit();
	}
</script>
<div id="categories" class="departments">
<h2 style="text-shadow: 1px 1px 1px Firebrick">Регистрация</h2>
</div>
<div id="fullsize_description">
<form method=POST enctype="multipart/form-data" name="mylot" id="aform">

<b>Укажите Email:</b><br><br>

    <input required type=text style="width:75%;max-width:450px;" name="email" onchange="check_email()" id="user_email" value="">

<br><div style="color:red;font-weight:600;display:none" id='ech_error'>Неправильный адрес email</div>
<br>
<b>Придумайте пароль:</b><br><br>

    <input required type=password style="width:75%;max-width:450px;margin-left: 50px;" name="pass" id="pass" onchange="check_pass()" value="" class=pass>
    
    <a href="#?" onclick="showPass()" style="position:relative;right:60px;color:gray;"><small>показать</small></a>
<div style="color:red;font-weight:600;display:none" id='pchv_error'>Придумайте другой пароль, введенный пароль слишком прост и ненадежен. Также убедитесь, что пароль не содержит логин или email</div>
<div style="color:red;font-weight:600;display:none" id='pch_error'>Пароль должен иметь длину от 6 символов и состоять из букв и цифр</div>

<br><br>
<b>Повторите пароль:</b><br><br>
    
    <input required type=password id='pass2' onchange="check_pass2()" style="width:75%;max-width:450px;margin-left: 50px;" name="pass2" value="" class=pass>
    
    <a href="#?" onclick="showPass()" style="position:relative;right:60px;color:gray;"><small>показать</small></a>
<br><div style="color:red;font-weight:600;display:none" id='ppch_error'>Введенные пароли не совпадают</div>
<br><br>
    <div id="noauth">
        <input type="submit" id="submit" class=green_button style="width:180px" value="Отправить" /><br>

    </div>
<br>
</form>
</center>
</div>
</div>
</div><br><br><br>

    <script type="text/javascript">
        $(document).ready(function () {
            $.validator.unobtrusive.parse((document).getElementsByTagName("form"));
        });

        $(function () {
            $('#submit').click(function (e) {
                    e.preventDefault();
                    var data = {
                        Email: $('#user_email').val(),
                        Password: $('#pass').val(),
                        ConfirmPassword: $('#pass2').val()
                    };

                    $.ajax({
                        type: 'POST',
                        url: 'http://localhost:49351/api/Account/Register',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify(data)
                    }).success(function (data) {

                        alert("Регистрация пройдена");
                        location.href = 'login.html';

                    }).fail(function (data) {

                        alert("В процесе регистрации возникла ошибка" + data.val());
                    });
            });
        })
    </script>
