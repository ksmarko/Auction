<!DOCTYPE html>
<html>
<head>
    <meta content="width=device-width" name="viewport">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta charset="utf-8">
    <title>Регистрация</title>
    <link href="favicon.ico" rel="icon">
    <link href="css/style.css" media="screen" rel="stylesheet" title="" type="text/css">
    <link href="css/portable_style.css" media="screen" rel="stylesheet" title="" type="text/css">
    <script src='js/jquery-11.0.min.js' type="text/javascript">
    </script>
</head>
<body onload="$('#mainform').focus();">
    <div class="top_nav">
        <div class="container">
            <div class="menu fullsize">
                <ul>
                    <li>
                        <a href="login.html">Войти</a>
                    </li>
                    <li style="list-style: none; display: inline">
                        <div class="arrow"></div>
                    </li>
                    <li>
                        <a href="register.html">Регистрация</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="ddmenu" id="ddm">
        <ul>
            <li>
                <a href="login.html">Войти</a>
            </li>
            <li style="list-style: none; display: inline">
                <div class="arrow"></div>
            </li>
            <li>
                <a href="register.html">Регистрация</a>
            </li>
            <li style="list-style: none; display: inline">
                <hr style="margin-top:10px;margin-bottom:10px;border:0; border-top: #FFF dashed 1px;">
            </li>
        </ul>
    </div>
    <div id="pagewrapper">
        <a href="index.html">
            <div class="skylogo"></div>
        </a>
        <div class="search_form">
            <form action="index.html" autocomplete="off" method="get">
                <input class="top_search" id="mainform" name="search" onclick="firstfocus=0;(this.value.length)&gt;0?$('#suggestions').show():0;" onfocus="this.selectionStart = this.selectionEnd = this.value.length;" oninput="(this.value.length)&gt;0?get_suggestions(this.value):$('#suggestions').hide()" onkeypress="(event.keyCode==32 && firstfocus==1)?($('#mainform').blur()):0;firstfocus=0;" placeholder="Что будем искать?" type="text" value=""> <!-- Скрипт отвечает за поиск -->
                <script>

                    var cur_loc = window.location.href;
                    cur_loc = cur_loc.replace(/\?t=[0-9]+/g, "");
                    function get_suggestions(query) {
                        if ($(window).width() > 880)
                            $.ajax({
                                url: "/suggestions.php",
                                type: "post", //отправить его методом get
                                data: { q: query },
                                dataType: 'json',
                                success: function (response) {
                                    suggestions = response;
                                    if (suggestions.length == 0) {
                                        $('#suggest_container').empty();
                                    } else {
                                        $('#suggest_container').empty();
                                        for (var i = 0; i < suggestions.length; i++) {
                                            if (suggestions[i][1] == 0)
                                                $('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('" + suggestions[i][0] + "');window.location.replace('/c" + parseInt(suggestions[i][2]) + "/s/')\"><span style='color:#606060;font-weight:normal;padding-right:2px;'>Категория<\/span>&nbsp;" + suggestions[i][3] + "" + suggestions[i][0] + "&nbsp;<img src='/styles/goto.png' style='width:11px;'><\/div>")
                                            else
                                                if (suggestions[i][1] == 3)
                                                    $('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('" + suggestions[i][0] + "');window.location.replace('/" + encodeURIComponent(suggestions[i][2]) + "/')\"><span style='color:#606060;font-weight:normal;padding-right:2px;'>Лот<\/span>&nbsp;" + suggestions[i][0] + "&nbsp;<span style='color:#606060;font-weight:normal;padding-right:2px;'>(" + suggestions[i][2] + ")<\/span>&nbsp;<img src='/styles/goto.png' style='width:11px;'><\/div>")
                                                else
                                                    if (suggestions[i][1] == 2)
                                                        $('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('" + suggestions[i][0] + "');window.location.replace('/" + encodeURIComponent(suggestions[i][0]) + "')\"><span style='color:#606060;font-weight:normal;padding-right:2px;'>Пользователь<\/span>&nbsp;" + suggestions[i][3] + "" + suggestions[i][0] + "&nbsp;<img src='/styles/goto.png' style='width:11px;'><\/div>")
                                                    else
                                                        $('#suggest_container').append("<div class=\"suggest\" onclick=\"$('#mainform').val('" + suggestions[i][0] + "');window.location.replace('/search.php?search=" + encodeURIComponent(suggestions[i][0]) + "')\">" + suggestions[i][0] + "<\/div>")
                                        }
                                        $('#suggestions').show()
                                    }
                                },
                                error: function (xhr) {
                                }
                            });
                    }
                    var rp = 45 * 60 * 1000;
                    $(window).bind('focus', function () {
                        ;

                        window.clearTimeout(rTimer);
                        rTimer = setTimeout(function () { var meta = document.createElement('meta'); meta.name = "referrer"; meta.content = "no-referrer"; document.getElementsByTagName('head')[0].appendChild(meta); window.location.href = cur_loc + '?t=' + 1 }, rp)
                    });

                    var rTimer = setTimeout(function () { var meta = document.createElement('meta'); meta.name = "referrer"; meta.content = "no-referrer"; document.getElementsByTagName('head')[0].appendChild(meta); window.location.href = cur_loc + '?t=' + 1 }, rp);

                </script> <input id='checkbox_hidden' name='desc_check' type='hidden' value='0'> <input id='cat_hidden' name='catid' type='hidden' value='0'> <input type="submit">
            </form>
        </div>
        <div class="suggestions" id="suggestions" style="display:none"></div>
    </div>
    <script>
        modal_multisearch = document.getElementById('modal_multisearch');
    </script>
    <div class="mcenter">
        <div class="bodywrapper">
            <br>
            <script>
                function showPass() {
                    var type = $('.pass').attr('type') == "text" ? "password" : 'text';
                    $('.pass').prop('type', type);
                }


                function isUserActive(username) {
                    $.getJSON('check_account6fb6.html?exist=1', { name: username }, function (list) {
                        var active = ""
                        $.each(list, function (i) {
                            active = this
                        });
                        if (active == 1) {
                            $('#user_login').css('border-bottom', '3px solid red')
                            $('#lche_error').show()
                        } else {
                            $('#user_login').css('border-bottom', '1px solid #d0d0d0')
                            $('#lche_error').hide()
                        }
                    });
                };

                function passCheck() {
                    $.getJSON('check_account.html', { pass: $('#pass').val(), login: $('#user_login').val(), email: $('#user_email').val() }, function (list) {
                        var valid = ""
                        $.each(list, function (i) {
                            valid = this
                        });
                        if (valid == 0) {
                            $('#pass').css('border-bottom', '3px solid red')
                            $('#pchv_error').show()
                        } else {
                            $('#pass').css('border-bottom', '1px solid #d0d0d0')
                            $('#pchv_error').hide()
                        }
                    });
                };

                function check_email() {
                    if (!$('#user_email').val().match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/g)) {
                        $('#user_email').css('border-bottom', '3px solid red')
                        $('#ech_error').show()
                        return false;
                    } else {
                        $('#user_email').css('border-bottom', '1px solid #d0d0d0')
                        $('#ech_error').hide()
                        isUserActive($('#user_email').val())
                        return true;
                    }
                }

                function check_pass() {
                    if (!$('#pass').val().match(/^(?=.*\d)(?=.*[a-zA-Z]).{6,32}$/g)) {
                        $('#pass').css('border-bottom', '3px solid red')
                        $('#pch_error').show()
                    } else {
                        $('#pass').css('border-bottom', '1px solid #d0d0d0')
                        $('#pch_error').hide()
                        passCheck()
                    }
                }

                function check_pass2() {
                    if ($('#pass2').val() != $('#pass').val()) {
                        $('#pass2').css('border-bottom', '3px solid red')
                        $('#ppch_error').show()
                    } else {
                        $('#pass2').css('border-bottom', '1px solid #d0d0d0')
                        $('#ppch_error').hide()
                        passCheck()
                    }
                }

                function onSubmit(token) {
                    document.getElementById("aform").submit();
                }
            </script>
            <div class="departments" id="categories">
                <h2 style="text-shadow: 1px 1px 1px Firebrick">Регистрация</h2>
            </div>
            <div id="fullsize_description">
                <form enctype="multipart/form-data" id="aform" method="post" name="mylot">
                    <b>Укажите Email:</b><br>
                    <br>
                    <input id="user_email" name="email" onchange="check_email()" required="" style="width:75%;max-width:450px;" type="text" value=""><br>
                    <div id='ech_error' style="color:red;font-weight:600;display:none">
                        Неправильный адрес email
                    </div><br>
                    <b>Придумайте пароль:</b><br>
                    <br>
                    <input class="pass" id="pass" name="pass" onchange="check_pass()" required="" style="width:75%;max-width:450px;margin-left: 50px;" type="password" value=""> <a href="#?" onclick="showPass()" style="position:relative;right:60px;color:gray;"><small>показать</small></a>
                    <div id='pchv_error' style="color:red;font-weight:600;display:none">
                        Придумайте другой пароль, введенный пароль слишком прост и ненадежен. Также убедитесь, что пароль не содержит логин или email
                    </div>
                    <div id='pch_error' style="color:red;font-weight:600;display:none">
                        Пароль должен иметь длину от 6 символов и состоять из букв и цифр
                    </div><br>
                    <br>
                    <b>Повторите пароль:</b><br>
                    <br>
                    <input class="pass" id='pass2' name="pass2" onchange="check_pass2()" required="" style="width:75%;max-width:450px;margin-left: 50px;" type="password" value=""> <a href="#?" onclick="showPass()" style="position:relative;right:60px;color:gray;"><small>показать</small></a><br>
                    <div id='ppch_error' style="color:red;font-weight:600;display:none">
                        Введенные пароли не совпадают
                    </div><br>
                    <br>
                    <div id="noauth">
                        <input class="green_button" id="submit" style="width:180px" type="submit" value="Отправить"><br>
                    </div><br>
                </form>
            </div>
        </div>
    </div><br>
    <br>
    <br>
    <script type="text/javascript">
        $(document).ready(function () {
            $.validator.unobtrusive.parse((document).getElementsByTagName("form"));
        });

        $(function () {
            $('#submit').click(function (e) {
                e.preventDefault();
                var data = {
                    Email: $('#user_email').val(),
                    Password: $('#pass').val(),
                    ConfirmPassword: $('#pass2').val()
                };

                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:49351/api/Account/Register',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data)
                }).success(function (data) {

                    alert("Регистрация пройдена");
                    location.href = 'login.html';

                }).fail(function (data) {

                    alert("В процесе регистрации возникла ошибка" + data.val());
                });
            });
        })
    </script>
</body>
</html>